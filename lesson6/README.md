### socket 粘包问题

#### 1. 什么是粘包问题

SOCKET粘包就是指发送方发送的若干包数据到达接收方时粘成了一包。如：发送了 ABC 和 DEF，但另一端接收到的却是 ABCD，像这种一次性读取了两条数据的情况就叫做粘包（正常情况应该是一条一条读取的）。

从接收缓冲区来看,后一包数据的头紧接着前一包数据的尾,出现粘包的原因是多方面的,可能是来自发送方,也可能是来自接收方。

#### 2. 为什么会出现粘包问题

这是因为 TCP 是面向连接的传输协议，TCP 传输的数据是以流的形式，而流数据是没有明确的开始结尾边界，所以 TCP 也没办法判断哪一段流属于一个消息。

粘包的主要原因：

- 发送方每次写入数据 < 套接字（Socket）缓冲区大小；
- 接收方读取套接字（Socket）缓冲区数据不够及时。

#### 3. 粘包的解决方案

- FixedLengthFrameDecoder
  - 消息长度固定，累计读取到消息长度总和为定长Len的报文之后即认为是读取到了一个完整的消息。计数器归位，重新读取。
  - 用来解决定长消息的粘包问题。
- DelimiterBasedFrameDecoder
  - 将特殊的分隔符作为消息分隔符，回车换行符是他的一种。
  - 用来解决以特殊符号作为消息结束符的粘包问题
- LengthFieldBasedFrameDecoder 
  - 通过在消息头定义长度字段来标识消息总长度。